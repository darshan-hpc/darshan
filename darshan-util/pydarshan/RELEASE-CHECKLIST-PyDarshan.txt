Notes on how to release a new version of PyDarshan
2020-06
-----------------------

 - Ensure python dev environment with dev dependencies, if not already present
    (- python3 -m venv venv)
    (- source venv/bin/activate)
    (- pip install .[dev,test]    # deps for packaging, testing, and docs generation)

 - About updating CHANGELOG.rst
    - Since version 3.5.0, pydarshan released as a part of Darshan package, the
      change history should go to `ChangeLog` at root folder.
 - Update version numbers in:
    darshan/__init__.py
 - About the pydarshan documents
    - Since version 3.5.0, all Darshan documents have been moved to
      readthedocs.io and are updated every time a new commit is pushed to the
      main branch.

 - Upload darshan package to test.pypi / pypi.org using cibuildwheel/twine:
    - pipx run build --sdist
        (in the pydarshan directory, creates a source distribution)
    - Download wheel artifacts from GitHub, copy them to 'dist/' directory
      created above.
        + Click on Actions in GitHub. On the left panel, click "Build Wheels".
        + Click on "Run workflow" to generate the artifacts. This will take
          about an hour.
        + Click on the latest workflow run named "Build Wheels"
        + At the bottom section, click the download icon to the right of
          'pydarshan-wheels-all' to download the artifact zip file, named
          'pydarshan-wheels-all.zip'.
        + Copy the zip file to to 'dist/' directory and run command 'unzip' to
          extract the wheel files.
        + Delete the zip file.
    - Test package on test.pypi.org first
        0. This requires test.pypi.org credentials for darshan project.
        1. Upload pydarshan package to testpypi by running command:
           "pipx run twine upload --repository testpypi dist/*"
        2. Go to https://test.pypi.org on a browser and search for package name
           of "darshan" to verify if the right version appears there.
        3. Test the package on your local machine.
           a. Uninstall exiting darshan from your environment by running
              command "pip uninstall darshan"
           b. Install darshan by running command
              "pip install -i https://test.pypi.org/simple/ --extra-index-url https://pypi.org/simple darshan==3.5.0"
           c. Verify by running command "pip show darshan"
           d. Download the official darshan source code tar ball, e.g.
              darshan-3.5.0.tar.gz, and untar it.
           e. cd darshan-3.5.0/darshan-util/pydarshan
           f. Make sure necessary python packages are installed by running
              command "pip install tox coverage flake8"
           g. Test by running commands:
              + make test
              + make test-all
              + make coverage
              + make lint
           h. Uninstall the test package by running command
              "pip uninstall darshan"
        4. When all the above tests passed, the package is ready for the
           official release.
    - Upload the package to PYPI
        + This requires PyPI credentials for darshan project
        + Official python packages are stored at pypi.org.
        + Run command "pipx run twine upload dist/*"
        + Go to https://pypi.org on a browser and search for package name
          of "darshan" to verify if the right version appears there.

 - Add/update spack package: py-darshan
    - add version entry
    - add hash of release tar.gz from pypi (because that one should always exist) / or use mcs darshan mirror
    - check if new dependencies are required (compare to requirements.txt)
    - submit as pull request to https://github.com/spack/spack

 - Announce:
    - Regular Darshan Release: Copy release notes for PyDarshan and attach as seperate section (mailinglist, website/blog)
    - PyDarshan only: Post release note section of PyDarshan (mailinglist, website/blog)

Note on Versions format:
    Our convention (as of October 2025) moving forward is to keep Darshan and PyDarshan releases in sync (even if one or the other doesnâ€™t have a meaningful update).
    (Whenever libdarshan-utils has a version change, PyDarshan is bumped accordingly, and vice versa.)
