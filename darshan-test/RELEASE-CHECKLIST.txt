Notes on how to release a new version of Darshan
2024-05
-----------------------

 1) check Darshan GitHub to see if there are any pending issues and/or PRs
    for the release milestone
    (https://github.com/darshan-hpc/darshan/milestones)
    - close the milestone, move unfinished issues to appropriate milestone
 2) check for any problems in recent CI workflows on the main GitHub and
    on the ALCF GitLab CI instance
 3) make sure that documentation on Read the Docs is up to date.  See
    instructions in readthedocs/DEVELOPER_NOTES.md
 4) update the Changelog, if needed (browse git log since last release)
    - commit
 5) update version number in top-level darshan.version file
    - See below for the guide line of setting the version number.
    - commit
 6) follow checklist for corresponding release of PyDarshan
    - found at darshan-util/pydarshan/RELEASE-CHECKLIST-PyDarshan.txt
    - NOTE: new PyDarshan version must be released with every Darshan release
 7) use "git status" to make sure that all changes have been committed and
    pushed to origin/main
 8) manually install Darshan and run regression tests on a workstation and/or
    an HPC system (e.g., ALCF Polaris)
    - after installing, run the following in darshan-test/regression:
      ./run-all.sh <darshan_install_prefix> <scratch_dir> <system_env_profile>
 9) copy example output file (from the above testing) and commit in
    the darshan-logs repo in the darshan_logs/release_logs/ directory
10) make a tag for the release according to instructions at
    http://git-scm.com/book/en/Git-Basics-Tagging
    - example (annotated tag, pushed to repo):
      git tag -a darshan-2.3.1 -m 'Darshan 2.3.1'
      git push origin darshan-2.3.1
    - NOTE: update the above to reflect the tag format needed by Read the
      Docs
11) manually create the release tarball
    - do a fresh checkout of the Darshan release tag
      git clone --branch darshan-2.3.1 \
      https://github.com/darshan-hpc/darshan.git darshan-2.3.1
    - make sure to pull in AutoPerf submodule
      git submodule update --init
    - remove all .git files/directories in the top-level of the repo
    - create release tarball
      tar -czvf darshan-2.3.1.tar.gz /path/to/darshan-2.3.1
    - upload tarball to CELS server
      scp darshan-2.3.1.tar.gz user@homes.cels.anl.gov:/nfs/pub_html/gce/projects/darshan/releases/
12) update download page on darshan web site: www.mcs.anl.gov/darshan/download
13) update darshan-runtime and darshan-util Spack packages with new release
    - consider whether new variants should be exposed based on new features
      enabled by the release
    - commit, submit PR to upstream Spack repository
14) announce on web page (new post) and mailing list

----
## Setting the release version number

There are two versions that must be set when making a new release:
software semantic version and libtool ABI version.

* Software Semantic Versioning
  + https://semver.org
  + A version number is in a form of MAJOR.MINOR.PATCH
    1. MAJOR version when you make incompatible API changes
    2. MINOR version when you add functionality in a backward compatible manner
    3. PATCH version when you make backward compatible bug fixes
  + A pre-release version MAY be denoted by appending a hyphen, for example,
    1.0.0-alpha.

* GNU Libtool's ABI versioning
  + http://www.gnu.org/software/libtool/manual/libtool.html#Updating-version-info
  + A version number is in a form of current.revision.age
    1. "current (c)" is the most recent interface number that this library
       implements. A change in this number typically indicates a
       backward-incompatible ABI change.
    2. "revision (r)" is the implementation number of the current interface.
       Tracks changes in the library's source code without affecting the ABI.
    3. "age (a)" is the difference between the newest and oldest interfaces that
       this library implements. It indicates the number of interfaces added
       since the last current increment.
  + Rules for Updating Version Information:
   * Initial State: Begin with 0:0:0 for new libraries.
   * Release-based Updates: Update versions only before a public release.
   * Source Code Changes: Increment "revision" if the source code has changed
     since the last update, even without interface changes.
     (c:r:a becomes c:r+1:a)
   * Interface Changes (Addition/Removal/Modification): Increment "current" and
     reset "revision" to 0 if any interfaces have been added, removed, or changed.
   * Interface Additions: Increment "age" if new interfaces have been added since
     the last public release.
   * Interface Removals: Reset "age" to 0 if any interfaces have been removed
     since the last public release.

